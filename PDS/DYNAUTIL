*                                                                       00003
* DYNAUTIL - DYNAMIC FRONT END FOR UTILITIES                            00004
*                                                                       00005
*            TOM FOTH, WSRCC, 03/09/82                                  00006
* SEE HELP FOR MORE DETAILS                                             00007
*                                                                       00008
DYNAUTIL BEGIN REQUS=YES                                                00009
         LR    R7,R12                                                   00010
         LA    R7,4095(R7)                                              00011
         LA    R7,1(R7)                                                 00012
         USING DYNAUTIL+4096,R7                                         00013
         LR    R2,R1                                                    00014
         GETMAIN R,LV=WORKL                                             00015
         LR    R11,R1                                                   00016
         USING WORKD,R11                                                00017
         SR    R8,R8                                                    00018
         MVI   PARMTBL,C' '     BLANK UTILITY NAME, VERBS               00019
         MVC   PARMTBL+1(L'UTILNAME+L'VERBFLDS-1),PARMTBL               00020
         XC    DDNMFLDS(L'DDNMFLDS),DDNMFLDS ZERO  DDNAMES              00021
         MVI   FLAGS,0                                                  00022
         L     R1,0(R2)         GET ADDR OF PARM IN R1                  00023
         ST    R1,PARMADDR      SAVE IT                                 00024
         LA    R1,0(R1)         PURIFY R1                               00025
         LH    R2,0(R1)         GET THE LENGTH                          00026
         LTR   R2,R2            DOES THE PARAMETER EXIST?               00027
         BZ    ENDPARM          NOPE                                    00028
         LA    R1,2(R1)         POINT TO THE STRING                     00029
         LA    R6,4             NUMBER OF POSSIBLE FIELDS- 1            00030
         LA    R5,1             NUMBER OF POSSIBLE PARMS FOR FIELD 1    00031
         LA    R3,UTILNAME      POINT TO THE FIRST PARMSAVE FOR FIELD 1 00032
PARMBGN  LA    R4,8(R3)         R4 PTR TO FIRST CHAR AFTER FIELD        00033
ELMNTCK  ALPHANUM 0(R1)         IS IT AN ALPHANUMERIC?                  00034
         BE    ELMNTOK          YEP                                     00035
         CLI   0(R1),C','       NOPE-IS IT A COMMA?                     00036
         BE    NEXTPARM         YEP, GO TO NEXT PARM                    00037
         CLI   0(R1),C'/'       NOPE-IS IT A SEMICOLON                  00038
         BE    NEXTFLD          YEP, GO TO NEXT VERB                    00039
         WTO  'DYN002E NONALPHANUMERIC IN PARM',ROUTCDE=(11)            00040
         LA    R8,2            SET THE ERROR CODE                       00041
         B     DIENODMP         EXIT                                    00042
ELMNTOK  CR    R4,R3            ARE WE POINTING PAST OUR FIELD          00043
         BE    ELMNTLEN         NOPE                                    00044
         MVC   0(1,R3),0(R1)    MOVE THE CHAR TO THE FIELD              00045
         LA    R1,1(R1)         POINT TO NEXT CHARACTER IN PARM         00046
         LA    R3,1(R3)         POINT TO NEXT CHARACTER IN FIELD        00047
         BCT   R2,ELMNTCK       GO GET ANOTHER CHARACTER IF ANY         00048
         B     ENDPARM          NO MORE-END PARM PROCESSING             00049
ELMNTLEN WTO  'DYN003E PARM ELEMENT EXCEEDS 8 CHARACTERS',ROUTCDE=(11)  00050
         LA    R8,3            SET THE RETURN CODE                      00051
         B     DIENODMP         EXIT                                    00052
NEXTPARM BCT   R2,NXTPARM1      DECREMENT FROM LENGTH COUNT             00053
BADPARM  WTO  'DYN004E INVALID PARM STRUCTURE',ROUTCDE=(11)             00054
         LA    R8,4            SET THE ERROR CODE                       00055
         B     DIENODMP         EXIT                                    00056
NXTPARM1 BCT   R5,NXTPARM2      DECREMENT FROM PARM COUNT               00057
         B     BADPARM          BAD PARM PROCESSING                     00058
NXTPARM2 LA    R1,1(R1)         POINT TO NEXT CHAR                      00059
         LR    R3,R4            POINT TO THE FIELD                      00060
         B     PARMBGN          GO SCAN                                 00061
NEXTFLD  BCT   R2,NXTFLD1       DECREMENT PARM COUNT                    00062
         B     BADPARM          BAD PARM PROCESSING                     00063
NXTFLD1  BCT   R6,NXTFLD2       DECREMENT FIELD COUNT                   00064
         B     ENDPARM          END PARM PROCESSING                     00065
NXTFLD2  LA    R1,1(R1)         POINT TO NEXT CHAR                      00066
         C     R6,=F'3'         PROCESSING VERBS?                       00067
         BNE   NXTFLD3          NOPE                                    00068
         LA    R3,VERBFLDS      POINT TO DDNAME FIELD                   00069
         LA    R5,8             NUMBER OF POSSIBLE DDNAMES              00070
         B     PARMBGN          GO SCAN                                 00071
NXTFLD3  DS    0H               POINT TO NEXT CHAR                      00072
         C     R6,=F'2'         PROCESSING VERBS?                       00073
         BNE   NXTFLD4          NOPE                                    00074
         LA    R3,DDNMFLDS      POINT TO DDNAME FIELD                   00075
         LA    R5,2             NUMBER OF POSSIBLE DDNAMES              00076
         B     PARMBGN          GO SCAN                                 00077
NXTFLD4  LA    R3,SYSDDS        POINT TO SYS DD OVERRIDE FIELD          00078
         MVC   SYSDDS(96),=XL96'00' CLEAR THE TABLE                     00079
         LA    R5,12            NUMBER OF POSSIBLE VERBS                00080
         B     PARMBGN          GO SCAN                                 00081
ENDPARM  STH   R2,PARMLEN       SAVE THE PARM LENGTH                    00082
         LTR   R2,R2            DO WE HAVE A PARM TO SAVE               00083
         BZ    NOPARM           NO SIR                                  00084
         CH    R2,=H'100'       PARM TO BIG                             00085
         BNH   PARMOK           NOPE                                    00086
         WTO  'DYN005E PARM LENGTH EXCEEDS 100 CHARACTERS',ROUTCDE=(11) 00087
         LA    R8,5            SET THE RETURN CODE                      00088
         B     DIENODMP         AND EXIT                                00089
PARMOK   LA    R1,1(R1)         POINT TO NEXT CHAR IN PARM              00090
         BCTR  R2,0             DECREMENT FO EX                         00091
         MVC   PARMFLD(*-*),0(R1) EXECUTED BELOW                        00092
         EX    R2,*-6           EXECUTE THE MOVE INSTRUCTION            00093
NOPARM   DS    0H                                                       00094
         LA    R1,8             EIGHT VERBS TO LOOK AT                  00095
         LA    R2,VERBFLDS      ADDRESS OF VERBTBL                      00096
VERBTST  CLI   0(R2),C' '                                               00097
         BE    VERBTSTA                                                 00098
         CLC   0(8,R2),=CL8'ICODE'                                      00099
         BNE   VERBTST1                                                 00100
         TM    FLAGS,ICODE                                              00101
         BO    DUPVERB                                                  00102
         OI    FLAGS,ICODE                                              00103
         B     VERBTSTA                                                 00104
VERBTST1 CLC   0(8,R2),=CL8'SCODE'                                      00105
         BNE   VERBTST2                                                 00106
         TM    FLAGS,SCODE                                              00107
         BO    DUPVERB                                                  00108
         TM    FLAGS,SIGNORE                                            00109
         BO    CONFVERB                                                 00110
         OI    FLAGS,SCODE                                              00111
         B     VERBTSTA                                                 00112
VERBTST2 CLC   0(8,R2),=CL8'SIGNORE'                                    00113
         BNE   VERBTST3                                                 00114
         TM    FLAGS,SIGNORE                                            00115
         BO    DUPVERB                                                  00116
         TM    FLAGS,SCODE                                              00117
         BO    CONFVERB                                                 00118
         OI    FLAGS,SIGNORE                                            00119
         B     VERBTSTA                                                 00120
VERBTST3 CLC   0(8,R2),=CL8'XCODE'                                      00121
         BNE   VERBTST4                                                 00122
         TM    FLAGS,XCODE                                              00123
         BO    DUPVERB                                                  00124
         TM    FLAGS,XIGNORE                                            00125
         BO    CONFVERB                                                 00126
         OI    FLAGS,XCODE                                              00127
         B     VERBTSTA                                                 00128
VERBTST4 CLC   0(8,R2),=CL8'XIGNORE'                                    00129
         BNE   VERBTSTE                                                 00130
         TM    FLAGS,XIGNORE                                            00131
         BO    DUPVERB                                                  00132
         TM    FLAGS,XCODE                                              00133
         BO    DUPVERB                                                  00134
         OI    FLAGS,XIGNORE                                            00135
         B     VERBTSTA                                                 00136
VERBTSTE WTO  'DYN025E PARAMETER CONTAINS ILLEGAL VERBS',ROUTCDE=(11)   00137
         LA    R8,25                                                    00138
         MVI   FLAGS,0                                                  00139
         B     DIENODMP                                                 00140
CONFVERB WTO  'DYN027E CONFLICTING VERBS FOUND IN PARM',ROUTCDE=(11)    00141
         LA    R8,27                                                    00142
         MVI   FLAGS,0                                                  00143
         B     DIENODMP                                                 00144
DUPVERB  WTO  'DYN026I DUPLICATE VERBS FOUND IN PARM - IGNORED',       X00145
               ROUTCDE=(11)                                             00146
VERBTSTA LA    R2,8(R2)                                                 00147
         BCT   R1,VERBTST                                               00148
         LA    R2,DDNMFLDS      ADDRESS OF DDNAMES                      00149
         LA    R3,14            THERE ARE FOURTEEN OF THEM              00150
NULDDTST CLI   0(R2),X'00'      HAS THIS FILED BEEN MODIFIED?           00151
         BE    BLNXTDD          NOPE                                    00152
         LA    R4,8             EIGHT CHARACTERS / DDNAME               00153
BLTSTCHR CLI   0(R2),X'00'      IS THIS CHARACTER A NULL                00154
         BNE   BLNXTCHR         NOPE                                    00155
         MVI   0(R2),C' '       YEP, BLANK IT                           00156
BLNXTCHR LA    R2,1(R2)         POINT TO NEXT CHARACTER                 00157
         BCT   R4,BLTSTCHR      GO SEE IT WE NEED TO BLANK              00158
         BCT   R3,NULDDTST      GO DO ANOTHER DDNAME                    00159
         B     MOVEDCBS         NO MORE, MOVE DCBS                      00160
BLNXTDD  LA    R2,8(R2)         POINT TO NEXT DDNAME                    00161
         BCT   R3,NULDDTST      AND BLANK IT                            00162
MOVEDCBS MVC   RPTDCB(LRPTDCB),MODELRPT  MOVE THE DCB'S                 00163
         MVC   CNTLIN(LCNTLIN),MODELCTL  TO WORKING STORAGE             00164
         MVC   REMOPN(LREMOPN),MODELOPN  TO WORKING STORAGE             00165
         MVC   REMLNK(LREMLNK),MODELLNK  TO WORKING STORAGE             00166
         LA    R10,RPTDCB                                               00167
         LA    R9,CNTLIN                                                00168
         CLI   RPTDD,X'00'      DID USER OVERRIDE RPT DDNAME            00169
         BE    OPENRPT          NOPE                                    00170
         MVC   X'28'(8,R10),RPTDD MOVE IN OVERRIDE DDNAME               00171
OPENRPT  OPEN  ((R10),(OUTPUT)),MF=(E,REMOPN) OPEN THE REPORT FILE      00172
         TM    X'30'(R10),X'10' OPEN REPORT OKAY                        00173
         BO    CNTLTST          YEP                                     00174
         WTO  'DYN001E COULD NOT OPEN REPORT DATASET',ROUTCDE=(11)      00175
         LA    R8,1                                                     00176
         B     DIEWDMP                                                  00177
CNTLTST  PUT   (R10),TTL001                                             00178
         PUT   (R10),TTL002                                             00179
         L     R3,PARMADDR      ADDRESS OF PARM                         00180
         LH    R2,0(R3)         LENGTH OF PARM                          00181
         LTR   R2,R2            WAS THERE ONE                           00182
         BNZ   MOVEPARM         YEP                                     00183
         MVC   INFODATA,INF022  NOPE                                    00184
         B     PUTPARM          PUT INFO MESSAGE                        00185
MOVEPARM PUT   (R10),TTL005     PUT HEADER                              00186
         MVI   INFOREC,C' '     CLEAR THE BUFFER                        00187
         MVC   INFOREC+1(L'INFOREC-1),INFOREC                           00188
         BCTR  R2,0             LESS ON FOR EX                          00189
         MVC   INFODATA(*-*),2(R3) TO BE EX'ED BELOW                    00190
         EX    R2,*-6           EX THE ABOVE                            00191
PUTPARM  PUT   (R10),INFOREC    PUT THE RECORD                          00192
         CLI   UTILNAME,C' '                                            00193
         BNE   NOUTLWRN                                                 00194
         PUT   (R10),INF020                                             00195
NOUTLWRN DS    0H                                                       00196
         PUT   (R10),TTL003                                             00197
         MVC   BLDLFF,=H'1'                                             00198
         MVC   BLDLLL,=H'14'                                            00199
         MVC   BLDLNAME,=CL8'DYNAM'                                     00200
         BLDL  0,BLDLFF                                                 00201
         LTR   R15,R15                                                  00202
         BZ    TSTUTIL                                                  00203
         C     R15,=F'8'                                                00204
         BNE   DYNAMISS                                                 00205
BLDLFAIL WTO  'DYN019E BLDL FAILED IN MODULE SEARCH',ROUTCDE=(11)       00206
         PUT  (R10),ERR019                                              00207
         LA    R8,19                                                    00208
         B     DIEWDMP                                                  00209
DYNAMISS WTO  'DYN017E DYNAM MODULE NOT IN JOB LINKLIST',ROUTCDE=(11)   00210
         PUT   (R10),ERR017                                             00211
         LA    R8,17                                                    00212
         B     DIENODMP                                                 00213
TSTUTIL  CLI   UTILNAME,C' '                                            00214
         BE    TSTCTLDD                                                 00215
         MVC   BLDLNAME,UTILNAME                                        00216
         BLDL  0,BLDLFF                                                 00217
         LTR   R15,R15                                                  00218
         BZ    TSTCTLDD                                                 00219
         C     R15,=F'8'                                                00220
         BE    BLDLFAIL                                                 00221
       WTO 'DYN018E SPECIFIED MODULE NOT IN JOB LINKLIST',ROUTCDE=(11)  00222
         PUT   (R10),ERR018                                             00223
         LA    R8,18                                                    00224
         B     DIENODMP                                                 00225
TSTCTLDD CLI   CTLDD,X'00'      DID USER OVERRIDE CTL DDNAME            00226
         BE    OPENCTL          NOPE                                    00227
         MVC   X'28'(8,R9),CTLDD MOVE IN OVERRIDE DDNAME                00228
OPENCTL  OPEN  ((R9),(INPUT)),MF=(E,REMOPN) OPEN THE CONTROL FILE       00229
         TM    X'30'(R9),X'10'  OPEN CONTROL OKAY                       00230
         BO    SETUPPRM         YEP                                     00231
         WTO  'DYN006E COULD NOT OPEN CONTROL DATASET',ROUTCDE=(11)     00232
         PUT   (R10),ERR006                                             00233
         LA    R8,6                                                     00234
         B     DIEWDMP                                                  00235
SETUPPRM DS    0H                                                       00236
         CLC   X'52'(2,R9),=H'80'         IS LRECL 80                   00237
         BE    LRECLOK                                                  00238
         WTO  'DYN012E LRECL OF CONTROL FILE NOT 80',ROUTCDE=(11)       00239
         PUT   (R10),ERR012                                             00240
         LA    R8,12                                                    00241
         B     DIENODMP                                                 00242
LRECLOK  TM    X'24'(R9),X'80'  IS IT FIXED                             00243
         B     RECFMOK                                                  00244
         WTO  'DYN013E RECFM OF CONTROL FILE NOT F OR FB',ROUTCDE=(11)  00245
         PUT   (R10),ERR013                                             00246
         LA    R8,13                                                    00247
         B     DIENODMP                                                 00248
RECFMOK  TM    X'1A'(R9),X'40' IS IT DSORG PS                           00249
         B     DSORGOK                                                  00250
         WTO  'DYN014E DSORG OF CONTROL FILE NOT PS',ROUTCDE=(11)       00251
         PUT   (R10),ERR014                                             00252
         LA    R8,14                                                    00253
         B     DIENODMP                                                 00254
DSORGOK  DS    0H                                                       00255
         MVC   DDNTBL(96),SYSDDS MOVE IN DDNAME TO CALL TABLE           00256
         LA    R0,PARMLEN       ADDRESS OF PARM                         00257
         ST    R0,PARMLST       SAVE IN ADDR LIST                       00258
         MVC   DDNTBLLN,=H'96'  LENGTH OF DDNAME TABLE                  00259
         LA    R0,DDNTBLLN      ADDRESS OF DDN TABLE                    00260
         ST    R0,PARMLST+4     SAVE IN ADDR LIST                       00261
         MVI   PARMLST+4,X'80'  END OF LIST                             00262
         CLC   SYSDDS(96),=XL96'00' ANY OVERRIDDEN DDNAMES              00263
         BNE   NOOVDDS          YEP                                     00264
         MVI   PARMLST,X'80'    NOPE, ONLY PARAMETER                    00265
NOOVDDS  XC    DYNAM,DYNAM      CLEAR WORK                              00266
         LA    R0,DYNAM         ADDR OF WORK VARIABLE                   00267
         ST    R0,PARMLST2      SAVED IN PARM LIST                      00268
         LA    R0,=CL4'INIT'    ADDR OF 'INIT'                          00269
         ST    R0,PARMLST2+4    SAVE IN PARM LIST                       00270
         MVI   PARMLST2+4,X'80' END OF PARM LIST                        00271
         LA    R1,PARMLST2      POINT TO PARM LIST                      00272
         LINK  EP=DYNAM         CALL DYNAM FOR INITIALIZATION           00273
         LTR   R15,R15          OKAY?                                   00274
         BZ    GETCMD           YEP                                     00275
         PUT   (R10),ERR007                                             00276
         WTO  'DYN007E DYNAM INITIALIZATION FAILED',ROUTCDE=(11)        00277
         LA    R8,7                                                     00278
         B     DIEWDMP                                                  00279
GETCMD   LA    R2,CARDS                                                 00280
         LA    R4,4                                                     00281
         MVI   CALLFLAG,X'00'          SET UP CALL FLAG                 00282
GETCMD1  GET   (R9)                                                     00283
         MVI   INFOREC,C' '                                             00284
         MVC   INFOREC+1(L'INFOREC-1),INFOREC                           00285
         MVC   INFODATA(80),0(R1)                                       00286
         C     R2,=F'4'                                                 00287
         BNE   GETCMD2                                                  00288
         MVI   INFOCNTL,C'0'                                            00289
GETCMD2  LR    R6,R1                                                    00290
         PUT   (R10),INFOREC                                            00291
         LR    R1,R6                                                    00292
         MVC   0(72,R2),0(R1)                                           00293
         LA    R3,72                                                    00294
         LR    R5,R2                                                    00295
FINDSEMI CLI   0(R5),C';'                                               00296
         BE    GOTSEMI                                                  00297
         LA    R5,1(R5)                                                 00298
         BCT   R3,FINDSEMI                                              00299
         LA    R2,72(R2)                                                00300
         BCT   R4,GETCMD1                                               00301
         PUT   (R10),ERR021                                             00302
         WTO  'DYN021E CONTINUATION EXCEEDS FOUR CARDS',ROUTCDE=(11)    00303
         LA    R8,21                                                    00304
         B     SXERRTST                                                 00305
GOTSEMI  EQU   *                                                        00306
         CLC   CARDS(4),=CL4'CALL;'                                     00307
         BE    CALLUTIL                                                 00308
         CLC   CARDS(4),=CL4'END;'                                      00309
         BE    XEQUTIL                                                  00310
         CLC   CARDS(4),=CL4'END '                                      00311
         BE    XEQUTIL                                                  00312
         CLC   CARDS(5),=CL5'INFO  '                                    00313
         BE    NOSUPORT                                                 00314
         CLC   CARDS(6),=CL6'ALLOC '                                    00315
         BE    GOODCMD                                                  00316
         CLC   CARDS(7),=CL7'ALLOCR '                                   00317
         BE    NOSUPORT                                                 00318
         CLC   CARDS(8),=CL8'UNALLOC '                                  00319
         BE    GOODCMD                                                  00320
         CLC   CARDS(7),=CL7'CONCAT '                                   00321
         BE    GOODCMD                                                  00322
         CLC   CARDS(9),=CL9'UNCONCAT '                                 00323
         BE    GOODCMD                                                  00324
         CLC   CARDS(7),=CL7'REMOVE '                                   00325
         BE    GOODCMD                                                  00326
         CLC   CARDS(8),=CL8'DDALLOC '                                  00327
         BE    GOODCMD                                                  00328
         PUT   (R10),ERR011                                             00329
         WTO  'DYN011E COMMAND IS INVALID',ROUTCDE=(11)                 00330
         LA    R8,11                                                    00331
         B     SXERRTST                                                 00332
NOSUPORT PUT   (R10),ERR015                                             00333
         WTO  'DYN015E DYNAM COMMAND NOT YET SUPPORTED',ROUTCDE=(11)    00334
         LA    R8,15                                                    00335
         B     SXERRTST                                                 00336
GOODCMD  LA    R1,CARDS                                                 00337
FINDSPC  CLI   0(R1),C' '       IS THIS THE SPACE AFTER THE CMD?        00338
         BE    GOTSPACE         YEP                                     00339
         LA    R1,1(R1)         NOPE-POINT TO NEXT CHAR                 00340
         B     FINDSPC          AND TRY AGAIN                           00341
GOTSPACE LA    R1,1(R1)         POINT PAST THE SPACE                    00342
         LA    R0,CARDS                                                 00343
         ST    R0,PARMLST2+4    SAVE THE ADDR OF THE CMD                00344
         ST    R1,PARMLST2+8    AND THE ADDR OF THE KEYWORDS            00345
         MVI   PARMLST2+8,X'80' MARK THE END OF THE LIST                00346
         LA    R1,PARMLST2      POINT TO THE LIST                       00347
         LINK  EP=DYNAM         CALL DYNAM                              00348
         LTR   R15,R15          WAS IT SUCCESSFUL                       00349
         BNZ   BADCMD           NOPE                                    00350
         PUT   (R10),INF016                                             00351
         B     GETCMD                                                   00352
BADCMD   C     R15,=F'20'       IS IT A KEYWORD ERROR?                  00353
         BE    KEYERR           YEP                                     00354
         C     R15,=F'28'       NOPE-IS IT A VALUE ERROR?               00355
         BE    VALERR           YEP                                     00356
         C     R15,=F'4'        NOPE-IS IT A ENV/SYS ERROR?             00357
         BE    TYPE4ERR         YEP                                     00358
         PUT   (R10),ERR008    PUT OUT ERROR MESSAGE                    00359
CMDFAIL  WTO  'DYN008E SYSTEM ERROR IN CALL TO DYNAM',ROUTCDE=(11)      00360
         LA    R8,8                                                     00361
         B     DIEWDMP                                                  00362
TYPE4ERR DS    0H                                                       00363
         LA    R1,DYNAM                                                 00364
         TM    10(R1),B'00000111'                                       00365
         BO    CMDFAIL                                                  00366
         TM    10(R1),B'00000100'                                       00367
         BNO   TYPE4ER1                                                 00368
      WTO 'DYN023E ENVIRONMENT ERROR FOUND DURING COMMAND',ROUTCDE=(11) 00369
         PUT   (R10),ERR023                                             00370
         LA    R8,23                                                    00371
         B     EXERRTST                                                 00372
TYPE4ER1 DS    0H                                                       00373
      WTO 'DYN024E UNAVAILABLE SYSTEM RESOURCE REQUESTED',ROUTCDE=(11)  00374
         PUT   (R10),ERR024                                             00375
         LA    R8,23                                                    00376
         B     EXERRTST                                                 00377
KEYERR   PUT   (R10),ERR009                                             00378
         WTO  'DYN009E KEYWORD IS INVALID',ROUTCDE=(11)                 00379
         LA    R8,9                                                     00380
         B     SXERRTST                                                 00381
VALERR   PUT   (R10),ERR010                                             00382
         WTO  'DYN010E KEYWORD ASSIGN INVALID VALUE',ROUTCDE=(11)       00383
         LA    R8,10                                                    00384
SXERRTST NI    FLAGS,X'FF'-RCCODE                                       00385
         TM    FLAGS,SCODE                                              00386
         BNO   SXERR1                                                   00387
         OI    FLAGS,RCCODE                                             00388
         B     EXIT03                                                   00389
SXERR1   TM    FLAGS,SIGNORE                                            00390
         BNO   EXIT03                                                   00391
         SR    R8,R8                                                    00392
         B     GETCMD                                                   00393
EXERRTST NI    FLAGS,X'FF'-RCCODE                                       00394
         TM    FLAGS,XCODE                                              00395
         BNO   EXERR1                                                   00396
         OI    FLAGS,RCCODE                                             00397
         B     EXIT03                                                   00398
EXERR1   TM    FLAGS,XIGNORE                                            00399
         BNO   EXIT03                                                   00400
         SR    R8,R8                                                    00401
         B     GETCMD                                                   00402
DIEWDMP  ABEND (R8),DUMP,,USER                                          00403
DIENODMP DS    0H                                                       00404
         NI    FLAGS,X'FF'-RCCODE                                       00405
         TM    FLAGS,ICODE                                              00406
         BNO   DYNODMP1                                                 00407
         OI    FLAGS,ICODE                                              00408
DYNODMP1 DS    0H                                                       00409
         C     R8,=F'12'                                                00410
         BL    EXIT01                                                   00411
         C     R8,=F'16'                                                00412
         BH    EXIT02A                                                  00413
         B     EXIT02                                                   00414
CALLUTIL DS    0H                                                       00415
         MVI   CALLFLAG,X'FF'          SET FLAG FOR CALL                00416
XEQUTIL  DS    0H                                                       00417
         CLI   UTILNAME,C' '    DID USER SPECIFY UTILTIY                00418
         BNE   XEQUTIL1         YES                                     00419
         PUT   (R10),INF030     NO, TELL USER                           00420
         B     EXIT03           EXIT                                    00421
XEQUTIL1 MVC   INFOREC,INF031                                           00422
         MVC   INFOREC+9(8),UTILNAME                                    00423
         PUT   (R10),INFOREC                                            00424
         LA    R2,UTILNAME                                              00425
         LA    R1,PARMLST                                               00426
         LINK  EPLOC=(R2),SF=(E,REMLNK)                                 00427
         LTR   R8,R15           DID WE GET A RETURN CODE                00428
         BNZ   UTILRET          YES                                     00429
         PUT   (R10),INF029     NO, TELL USER                           00430
         CLI   CALLFLAG,X'FF'          WAS CALL SPECIFIED               00431
         BE    GETCMD                  YES GO GET NEXT CARD             00432
         B     EXIT03           EXIT                                    00433
UTILRET  OI    FLAGS,RCCODE     YES, FLAG AS RETURN CODE                00434
         WTO  'DYN028I SEE REPORT LISTING-INVOKED PROGRAM COMPLETED WITX00435
               H NONZERO RETURN CODE.',ROUTCDE=(11)                     00436
         CVD   R8,DOUBLE                                                00437
         UNPK  UNPKAREA,DOUBLE                                          00438
         OI    UNPKAREA+9,X'F0'                                         00439
         LA    R1,UNPKAREA                                              00440
FINDNZER CLI   0(R1),C'0'                                               00441
         BNE   PUTINF28                                                 00442
         LA    R1,1(R1)                                                 00443
         B     FINDNZER                                                 00444
PUTINF28 LA    R2,UNPKAREA+9                                            00445
         SR    R2,R1                                                    00446
         MVI   INFOREC,C' '                                             00447
         MVC   INFOREC+1(L'INFOREC-1),INFOREC                           00448
         MVC   INFOREC(L'INF28PRE),INF28PRE                             00449
         MVC   INFOREC+L'INF28PRE(*-*),0(R1)                            00450
         EX    R2,*-6                                                   00451
         LA    R1,INFOREC+L'INF28PRE                                    00452
         LA    R1,1(R1,R2)                                              00453
         MVC   0(L'INF28END,R1),INF28END                                00454
         PUT   (R10),INFOREC                                            00455
         CLI   CALLFLAG,X'FF'          WAS CALL SPECIFIED               00456
         BE    GETCMD                  YES GO GET NEXT CARD             00457
EXIT03   DS    0H                                                       00458
         LA    R0,=CL3'END'                                             00459
         ST    R0,PARMLST2+4                                            00460
         MVI   PARMLST2+4,X'80'                                         00461
         LA    R1,PARMLST2                                              00462
         LINK  EP=DYNAM                                                 00463
EXIT02   CLOSE ((R9)),MF=(E,REMOPN)                                     00464
EXIT02A  CLOSE ((R10)),MF=(E,REMOPN)                                    00465
EXIT01   FREEMAIN R,LV=WORKL,A=(R11)                                    00466
         TM    FLAGS,RCCODE                                             00467
         BO    FINI                                                     00468
         LTR   R8,R8                                                    00469
         BZ    FINI                                                     00470
         ABEND (R8),,,USER                                              00471
FINI     DS    0H                                                       00472
         FINISH RC=(R8)                                                 00473
MODELRPT DCB   DDNAME=DYNARPT,LRECL=133,BLKSIZE=133,RECFM=FBA,         X00474
               DSORG=PS,MACRF=(PM)                                      00475
MODELCTL DCB   DDNAME=DYNAIN,MACRF=(GL),DSORG=PS,EODAD=XEQUTIL          00476
MODELOPN OPEN  (,),MF=L                                                 00477
MODELLNK LINK EPLOC=0,SF=L                                              00478
ERR006 DC CL133' DYN006E COULD NOT OPEN CONTROL DATASET'                00479
ERR007 DC CL133' DYN007E DYNAM INITIALIZATION FAILED'                   00480
ERR008 DC CL133' DYN008E SYSTEM ERROR IN CALL TO DYNAM'                 00481
ERR009 DC CL133' DYN009E KEYWORD IS INVALID'                            00482
ERR010 DC CL133' DYN010E KEYWORD ASSIGN INVALID VALUE'                  00483
ERR011 DC CL133' DYN011E COMMAND IS INVALID'                            00484
ERR012 DC CL133' DYN012E LRECL OF CONTROL FILE NOT 80'                  00485
ERR013 DC CL133' DYN013E RECFM OF CONTROL FILE NOT F OR FB'             00486
ERR014 DC CL133' DYN014E DSORG OF CONTROL FILE NOT PS'                  00487
ERR015 DC CL133' DYN015E DYNAM COMMAND NOT YET SUPPORTED'               00488
INF016 DC CL133' DYN016I ABOVE REQUEST SUCCESSFULLY COMPLETED'          00489
ERR017 DC CL133' DYN017E DYNAM MODULE IN NOT IN JOB LINKLIST'           00490
ERR018 DC CL133' DYN018E SPECIFIED MODULE NOT IN JOB LINKLIST'          00491
ERR019 DC CL133' DYN019E BLDL FAILED IN MODULE SEARCH'                  00492
INF020 DC CL133' DYN020I NO PROGRAM SPECIFIED - IEFBR14 ASSUMED'        00493
ERR021 DC CL133' DYN021E CONTINUATION EXCEEDS FOUR CARDS'               00494
INF022 DC CL133' DYN017I NO PARAMETER SPECIFIED'                        00495
ERR023 DC CL133' DYN023E ENVIRONMENT ERROR FOUND DURING COMMAND'        00496
ERR024 DC CL133' DYN024E UNAVAILABLE SYSTEM RESOURCE REQUESTED'         00497
INF28PRE DC CL52'0DYN028I INVOKED PROGRAM COMPLETED WITH RETURN CODE '  00498
INF28END DC CL11' (DECIMAL).'                                           00499
INF029 DC CL133'0DYN029I INVOKED PROGRAM COMPLETED WITH A RETURN CODE OX00500
               F ZERO.'                                                 00501
INF030 DC CL133'0DYN030I IEFBR14 SIMULATION COMPLETES WITH A RETURN CODX00502
               E OF ZERO.'                                              00503
INF031 DC CL133'0DYN031I XXXXXXXX HAS BEEN CALLED BY DYNAUTIL.'         00504
TTL001 DS 0CL133                                                        00505
       DC CL48'1 '                                                      00506
       DC CL38'W. S. R. C. C.   ---   D Y N A U T I L'                  00507
       DC CL47' '                                                       00508
TTL002 DS 0CL133                                                        00509
       DC CL47'0 '                                                      00510
       DC CL39'DYNAMIC ALLOCATION UTILITY PREPROCESSOR'                 00511
       DC CL47' '                                                       00512
TTL003 DC CL133'-CONTROL CARDS:'                                        00513
TTL005 DC CL133'-PARAMETER VALUE:'                                      00514
WORKD    DSECT                                                          00515
DOUBLE   DS    D                                                        00516
PARMADDR DS    F                                                        00517
PARML    DS    H                                                        00518
INFOREC  DS    0CL133                                                   00519
INFOCNTL DS    C                                                        00520
INFODATA DS    CL132                                                    00521
FLAGS    DS    X                                                        00522
ICODE    EQU   B'10000000'                                              00523
SCODE    EQU   B'01000000'                                              00524
SIGNORE  EQU   B'00100000'                                              00525
XCODE    EQU   B'00010000'                                              00526
XIGNORE  EQU   B'00001000'                                              00527
RCCODE   EQU   B'00000100'                                              00528
RESVD1   EQU   B'00000010'                                              00529
RESVD2   EQU   B'00000001'                                              00530
CALLFLAG DS    X                                                        00531
UNPKAREA DS   CL10                                                      00532
PARMTBL  DS    0CL184           SAVE PARMS FROM EXEC CARD               00533
UTILNAME DS    CL8              UTILITY TO CALL                         00534
VERBFLDS DS    0CL64            SPACE FOR VERBS FROM PARM               00535
VERB     DS    8CL8                                                     00536
DDNMFLDS DS    0CL112           DDNAMES SPECIFIED                       00537
RPTDD    DS    CL8              REPORT DDNAME FOR THIS PROGRAM          00538
CTLDD    DS    CL8              CONTROL CARDS FOR THIS PROGRAM          00539
SYSDDS   DS    12CL8            SYSIN FOR UTILITY                       00540
DDNTBLLN DS    H                                                        00541
DDNTBL   DS    12CL8            DDNAMES FOR UTILITY                     00542
PARMLST  DS    2F               PARMLST FOR UTILITY CALL                00543
PARMLST2 DS    3F               PARMLST FOR DYNAM CALLS                 00544
DYNAM    DS    F                WORK FOR DYNAM                          00545
PARMLEN  DS    H                LENGTH OF PARM FOR UTILTIY CALL         00546
PARMFLD  DS    CL100            PARMS FOR UTILITY CALL                  00547
BLDLFF   DS    H                                                        00548
BLDLLL   DS    H                                                        00549
BLDLNAME DS    CL8                                                      00550
BLDLTTR  DS    CL3                                                      00551
BLDLK    DS    X                                                        00552
BLDLZ    DS    X                                                        00553
BLDLC    DS    X                                                        00554
RPTDCB   DCB   DDNAME=DYNARPT,LRECL=133,BLKSIZE=133,RECFM=FBA,         X00555
               DSORG=PS,MACRF=(PM)                                      00556
LRPTDCB  EQU   *-RPTDCB                                                 00557
CNTLIN   DCB   DDNAME=DYNAIN,MACRF=(GL),DSORG=PS,EODAD=XEQUTIL          00558
LCNTLIN  EQU   *-CNTLIN                                                 00559
REMOPN   OPEN  (,),MF=L                                                 00560
LREMOPN  EQU   *-REMOPN                                                 00561
REMLNK   LINK EPLOC=0,SF=L                                              00562
LREMLNK  EQU   *-REMLNK                                                 00563
CARDS    DS    4CL72                                                    00564
WORKL    EQU   *-WORKD          LENGTH OF DSECT                         00565
         END   DYNAUTIL                                                 00566
